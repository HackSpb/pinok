			<div class="row block_personal_task">
				<div class="col-md-12" style="background:yellow;">
					<div class="col-md-10"><h2>Поехать на Таити! "Это волшебное место!" </h2></div><div class="col-md-2"></div>
				</div>
			</div>
			<div class="row main_block_special">
					<div class="col-md-2" style="background:#A4ABB7; height:700px">
						<a href="?task_n=imp"><div class="col-md-12" style="height:20px; background:grey; color: yellow; margin-top:10px;">Важные</div></a>
						<div id="imp"></div>
						<a href="?task_n=last"><div class="col-md-12" style="height:20px; background:grey; color: yellow; margin-top:10px;">Последние</div></a>
						<div id="last"></div>
						<a href="?task_n=fav"><div class="col-md-12" style="height:20px; background:grey; color: yellow; margin-top:10px;">Избранные</div></a>
						<div id="favourite"></div>
						<a onclick="$('#all').slideToggle('slow');" href="javascript://"><div class="col-md-12" style="height:20px; background:grey; color: yellow; margin-top:10px;">Все</div></a>
						<div id="all" style="display: none;">
							<a href="?task_n=proj"><div class="col-md-12" style="height:20px; background:grey; color: yellow; margin-top:10px;">Проекты</div></a>
							<a href="?task_n=even"><div class="col-md-12" style="height:20px; background:grey; color: yellow; margin-top:10px;">События</div></a>
							<a href="?task_n=task"><div class="col-md-12" style="height:20px; background:grey; color: yellow; margin-top:10px;">Задачи</div></a>
						</div>
					</div>
					<div class="col-md-7">
						<div id="content"></div>
					</div>
					<div class="col-md-3" style="background:#A4ABB7">
						<form id="create_task_form">
							<div class="row">
								<div class="col-md-8">
									<input type="text" id="task_name" required>
								</div>
								<div class=" col-md-offset-1 col-md-3">
									<input type="submit" class="btn" value="го">
								</div>
							</div>
							<div class="row">								
									<ul class="nav nav-tabs">									
									    <li><a href="#user" data-toggle="tab" aria-expanded="false"><div id="user_ico"><div class="icon-user button_task_user"></div></div></a></li>
									    <li><a href="#calendar" data-toggle="tab" aria-expanded="false"><div id="calendar_ico"><div class="icon-calendar button_task_no_calendar"></div></div></a></li>
									    <li><a href="#importance" data-toggle="tab" aria-expanded="false"><div id="importance_ico"><div class="icon-notification button_task_importan"></div></div></a></li>
									    <li><a href="#tags" data-toggle="tab" aria-expanded="false"><div id="tags_ico"><div class="button_task_task">З</div></div></a></li>									
									</ul>								
									<div id="myTabContent" class="tab-content">
									    <div class="tab-pane fade in" id="user">
									    	<div class="form-group">
									    		<center>								  
										    		<input type="radio" id="email_1" class="input_x" onclick="task_for_user()" name="task_for" value="1" checked />
													<label class="label_x" for="email_1">Для себя</label>
													<input type="radio" id="email_2" class="input_x" onclick="task_for_user()" name="task_for" value="2" />
													<label class="label_x" for="email_2">Для другого</label>
												</center>
											</div>
											<div id="email"></div>
									  	</div>
									  	<div class="tab-pane fade" id="calendar">
									  		<div class="form-group">
												<center>
										    		<input type="radio" id="calendar_1" class="input_x" onclick="deadline_for_task()" name="deadline" value="1" />
													<label class="label_x" for="calendar_1">Установить срок</label>
													<input type="radio" id="calendar_2" class="input_x" onclick="deadline_for_task()" name="deadline" value="2" checked />
													<label class="label_x" for="calendar_2">Без срока</label>
												</center>						
												<div id="deadline_date"></div>
											</div>
									  	</div>
									  	<div class="tab-pane fade" id="importance">
									  		<center>
										    	<div class="rating">
										    		<input type="radio" id="star_5" class="input_s" onclick="raiting_for_task()" name="stars" value="5" />
												    <label for="star_5" class="label_s"> &#9734;</label>
												    <input type="radio" id="star_4" class="input_s" onclick="raiting_for_task()" name="stars" value="4" />
												    <label for="star_4" class="label_s"> &#9734;</label>
												    <input type="radio" id="star_3" class="input_s" onclick="raiting_for_task()" name="stars" value="3" />
												    <label for="star_3" class="label_s"> &#9734;</label>
												    <input type="radio" id="star_2" class="input_s" onclick="raiting_for_task()" name="stars" value="2" />
												    <label for="star_2" class="label_s"> &#9734;</label>
													<input type="radio" id="star_1" class="input_s" onclick="raiting_for_task()" name="stars" value="1" />
												    <label for="star_1" class="label_s"> &#9734;</label>
												</div>
											</center>
									  	</div>
									  	<div class="tab-pane fade" id="tags">
									  		<center>								
										    	<p><input type="radio" id="type_1" class="input_x" onclick="type_for_task()" name="type" value="4" />
												<label class="label_x" for="type_1">Проект</label></p>
												<p><input type="radio" id="type_2" class="input_x" onclick="type_for_task()" name="type" value="61" />
												<label class="label_x" for="type_2">Событие</label></p>
												<p><input type="radio" id="type_3" class="input_x" onclick="type_for_task()" name="type" value="62" checked />
												<label class="label_x" for="type_3">Задача</label></p>										
											</center>
									  	</div>
									</div>
								</form>
							</div>
							<div class="row">
								<div id="answer"></div>
							</div>						
					</div>

			</div>
			<div class="temp_task" id="temp_task" style="display:none">			
				<a class="link"><div class="t_short_name"></div></a>
			</div>
			<div class="col-md-4" style="display:none">
				<div class="home-info-block" style="height:220px; margin-top: 20px;">
					<h3>Покормить котенка</h3>
					<p>Покорми котенка</p>
				</div>
			</div>
			<div class="col-md-12" style="display:none">
				<div class="home-info-block" style="height:220px; margin-top: 20px;">
					<h3 class="t_name"></h3>
					<p></p>
				</div>
			</div>
			<script>

				function task_for_user() {
					var task_for = $('input:radio[name=task_for]:checked').val();
						$("#answer").html('');
		  				if (task_for == '1') { 
		  					this.className = 'email';
		  					email.innerHTML = '';
		  					this.className = 'user_ico';
		  					user_ico.innerHTML = '<div class="icon-user button_task_user">';
		  				} else if (task_for == '2') { 
		  					this.className = 'email';
		  					email.innerHTML = '<div class="form-group"><label for="email_friend" class="col-sm-3 control-label">Email</label><div class="col-sm-9"><input type="email" name="email_friend" class="form-control" id="email_friend" required></div></div>';
		  					this.className = 'user_ico';
		  					user_ico.innerHTML = '<div class="icon-for_other button_task_for_other">';
		  				}
				};

				function deadline_for_task() {
					var deadline = $('input:radio[name=deadline]:checked').val();
	  				if (deadline == '1') { 
	  					this.className = 'deadline_date';
					  	deadline_date.innerHTML = '<center><select name="task_deadline" class="form-control" id="task_deadline_year">{% for i in 2016..2025 %}<option {% if "now"|date("Y") == i %}selected{% endif %} value="{{ i }}">{{ i }}</option>{% endfor %}</select><select name="task_deadline" class="form-control" id="task_deadline_month"><option {% if "now"|date("m") == 01 %}selected{% endif %} value="01">Январь</option><option {% if "now"|date("m") == 02 %}selected{% endif %} value="02">Февраль</option><option {% if "now"|date("m") == 03 %}selected{% endif %} value="03">Март</option><option {% if "now"|date("m") == 04 %}selected{% endif %} value="04">Апрель</option><option {% if "now"|date("m") == 05 %}selected{% endif %} value="05">Май</option><option {% if "now"|date("m") == 06 %}selected{% endif %} value="06">Июнь</option><option {% if "now"|date("m") == 07 %}selected{% endif %} value="07">Июль</option><option {% if "now"|date("m") == 08 %}selected{% endif %} value="08">Август</option><option {% if "now"|date("m") == 09 %}selected{% endif %} value="09">Сентябрь</option><option {% if "now"|date("m") == 10 %}selected{% endif %} value="10">Октябрь</option><option {% if "now"|date("m") == 11 %}selected{% endif %} value="11">Ноябрь</option><option {% if "now"|date("m") == 12 %}selected{% endif %} value="12">Декабрь</option></select><select name="task_deadline" class="form-control" id="task_deadline_day">{% for i in 1..31 %}<option {% if "now"|date("d") == i %}selected{% endif %} value="{{ i }}">{{ i }}</option>{% endfor %}</select><select name="task_deadline" class="form-control" id="task_deadline_hour">{% set h = "now"|date("H") + 1 %}{% for i in 0..23 %}<option {% if h == i %}selected{% endif %} value="{{ i }}">{{ i }}:00</option>{% endfor %}</select></center>';
					  	this.className = 'calendar_ico';
	  					calendar_ico.innerHTML = '<div class="icon-calendar button_task_calendar">';
	  				} else if (deadline == '2') { 
	  					this.className = 'deadline_date';
					  	deadline_date.innerHTML = '';
					  	this.className = 'calendar_ico';
	  					calendar_ico.innerHTML = '<div class="icon-calendar button_task_no_calendar">';
	  				}
				};

				function raiting_for_task() {
					var stars = $('input:radio[name=stars]:checked').val();
	  				if (stars == '1') { 
	  					this.className = 'importance_ico';
		  				importance_ico.innerHTML = '<div class="button_task_imp">1</div>';
	  				} else if (stars == '2') { 
	  					this.className = 'importance_ico';
		  				importance_ico.innerHTML = '<div class="button_task_imp">2</div>';
	  				} else if (stars == '3') { 
	  					this.className = 'importance_ico';
		  				importance_ico.innerHTML = '<div class="button_task_imp">3</div>';
	  				} else if (stars == '4') { 
	  					this.className = 'importance_ico';
		  				importance_ico.innerHTML = '<div class="button_task_imp">4</div>';
	  				} else if (stars == '5') { 
	  					this.className = 'importance_ico';
		  				importance_ico.innerHTML = '<div class="button_task_imp">5</div>';
	  				}
				};

				function type_for_task() {
					var type = $('input:radio[name=type]:checked').val();
	  				if (type == '4') { 
	  					this.className = 'tags_ico';
		  				tags_ico.innerHTML = '<div class="button_task_project">П</div>';
	  				} else if (type == '61') { 
	  					this.className = 'tags_ico';
		  				tags_ico.innerHTML = '<div class="button_task_event">С</div>';
	  				} else if (type == '62') { 
	  					this.className = 'tags_ico';
		  				tags_ico.innerHTML = '<div class="button_task_task">З</div>';
	  				}
				};


				create_task_form.onsubmit = function() {
					var task_for = $('input:radio[name=task_for]:checked').val();
					var email_friend = $('#email_friend').val();
					var task_name = $('#task_name').val();
					var task_deadline_turn = $('input:radio[name=deadline]:checked').val();		
					var task_deadline_year = $('#task_deadline_year').val();
					var task_deadline_month = $('#task_deadline_month').val();
					var task_deadline_day = $('#task_deadline_day').val();
					var task_deadline_hour = $('#task_deadline_hour').val();
					var task_stars = $('input:radio[name=stars]:checked').val();
					var task_type = $('input:radio[name=type]:checked').val();

					//alert(task_for+' '+email_friend+' '+task_name+' '+task_deadline_turn+' '+task_deadline_year+' '+task_deadline_month+' '+task_deadline_day+' '+task_deadline_hour+' '+task_stars+' '+task_type);
					if (task_for == 2 && task_type == 4) {
						var answer = '<div class="alert alert-dismissible alert-warning"><button type="button" class="close" data-dismiss="alert">&times;</button><strong>Внимание! </strong> Вы можете создать проект только для себя.</div>';
						$("#answer").html(answer);
						return false;
					} else {
						var query = 'task_for='+task_for+'&email_friend='+email_friend+'&task_name='+task_name+'&task_deadline_turn='+task_deadline_turn+'&task_deadline_year='+task_deadline_year+'&task_deadline_month='+task_deadline_month+'&task_deadline_day='+task_deadline_day+'&task_deadline_hour='+task_deadline_hour+'&task_stars='+task_stars+'&task_type='+task_type;	
						//alert(query);
						//return false;
						$.ajax({
							type: "POST",
							url: "/task/do/create",
							data: query,
							success: function(answer) {
								$("#answer").html(answer);
								download_list();
							}
						});	
						$('#create_task_form')[0].reset();
						this.className = 'user_ico';
		  				user_ico.innerHTML = '<div class="icon-user button_task_user"></div>';
		  				this.className = 'calendar_ico';
		  				calendar_ico.innerHTML = '<div class="icon-calendar button_task_no_calendar"></div>';
		  				this.className = 'importance_ico';
		  				importance_ico.innerHTML = '<div class="icon-notification button_task_importan"></div>';
		  				this.className = 'tags_ico';
		  				tags_ico.innerHTML = '<div class="button_task_task">З</div>';

		  				this.className = 'email';
		  				email.innerHTML = '';
		  				this.className = 'deadline_date';
		  				deadline_date.innerHTML = '';
						return false;
					}
				}

				$(document).ready(function(){
				    download_list();
				});

				function download_list(){
					$.getJSON("/task/select/list",
				        function(data){
				        console.log(data);
				        var i; 
				       
				        var s = $('#temp_task').html();// берем образцовый хтмл из скрытого шаблона 
				        if (data.imp != 1) {
							for (i=0;i<50;i++){
								directives = {
									link: {
									    href: function(params) {
									    	return "?task_n=" + data.imp['number_'+i].t_id;
										}
									}
								};
								$('#imp').append("<div id='id_imp_"+i+"'>"+ s + "</div>"); // плодим дивы по нашему шаблону с уникальными ид
					
								$('#id_imp_'+i).render(data.imp['number_'+i], directives); //рендерим свежевставленные дивы с шаблонами
							}	
						}
						if (data.last != 1) {
							for (i=0;i<50;i++){
								directives = {
									link: {
									    href: function(params) {
									    	return "?task_n=" + data.last['number_'+i].t_id;
									    }
									}
								};
							
								$('#last').append("<div id='id_last_"+i+"'>"+ s + "</div>"); 
					
								$('#id_last_'+i).render(data.last['number_'+i], directives); 
							}
						}
						if (data.fav != 1) {
							for (i=0;i<50;i++){
								directives = {
									link: {
									    href: function(params) {
									    	return "?task_n=" + data.fav['number_'+i].t_id;
									    }
									}
								};
					
								$('#favourite').append("<div id='id_fav_"+i+"'>"+ s + "</div>"); 
					
								$('#id_fav_'+i).render(data.fav['number_'+i], directives); 
							}	
						}
				    });
				}

			</script>
		
